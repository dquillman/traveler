{% extends "base.html" %}
{% block title %}Map Â· Traveler{% endblock %}
{% block content %}
<h1>Map</h1>
<div class="panel" style="padding:12px; margin-bottom:16px;">
  <div id="map" style="height:540px; width:100%; border-radius:10px;"></div>
</div>
<script>
  const map = L.map('map', { scrollWheelZoom: false }).setView([39.5, -98.35], 4);
  L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
    attribution: '&copy; OSM & CARTO', subdomains: 'abcd', maxZoom: 20
  }).addTo(map);
  const markers = [];
  {% for s in stays %}
    {% if s.latitude and s.longitude %}
      (function() {
        const m = L.marker([{{ s.latitude }}, {{ s.longitude }}]).addTo(map)
          .bindPopup(`<strong>{{ s.park|default:"Stay" }}</strong><br>{{ s.city|default:"" }}{% if s.state %}, {{ s.state }}{% endif %}`);
        markers.push(m);
      })();
    {% endif %}
  {% endfor %}
  if (markers.length) {
    const group = L.featureGroup(markers);
    map.fitBounds(group.getBounds().pad(0.2));
  }
</script>
{% endblock %}
