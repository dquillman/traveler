{% extends "stays/base.html" %}
{% block content %}
  <div class="card">
    <h1 style="margin-top:0;">Appearance</h1>
    <p class="muted">Toggle the theme below. This preference is saved in your browser.</p>

    <div style="display:flex; gap:12px; align-items:center; margin:10px 0;">
      <span>Theme:</span>
      <label style="display:flex; align-items:center; gap:6px;">
        <input type="radio" name="theme" value="dark" />
        <span>Dark</span>
      </label>
      <label style="display:flex; align-items:center; gap:6px;">
        <input type="radio" name="theme" value="light" />
        <span>Light</span>
      </label>
      <button id="apply-theme" class="btn btn-outline" type="button">Apply</button>
    </div>

    <dl>
      <dt>Site Name</dt><dd>{{ site_appearance.site_name }}</dd>
      <dt>Primary Color</dt><dd>{{ site_appearance.primary_color }}</dd>
      <dt>Secondary Color</dt><dd>{{ site_appearance.secondary_color }}</dd>
    </dl>
  </div>
  <div class="card" style="margin-top:12px;">
    <h2 style="margin-top:0;">Data Utilities</h2>
    <p class="muted">Bulk fill missing coordinates using city/state/address. Uses OpenStreetMap Nominatim; please be patient.</p>
    <form method="post" action="{% url 'stays:appearance_geocode' %}" onsubmit="return confirm('Geocode missing coordinates now?');" style="display:flex; gap:12px; align-items:center; flex-wrap:wrap;">
      {% csrf_token %}
      <label>Limit: <input class="txt" type="number" name="limit" min="1" value="1000" style="width:120px"></label>
      <button class="btn btn-outline" type="submit">Bulk Geocode Missing Coordinates</button>
      <a class="btn" href="{% url 'stays:map' %}">View Map</a>
    </form>
  </div>

  <div class="card" style="margin-top:12px; border-color:#7f1d1d;">
    <h2 style="margin-top:0; color:#ef4444;">Danger Zone</h2>
    <p class="muted">This permanently deletes all stays from the database. There is no undo.</p>
    <form method="post" action="{% url 'stays:appearance_purge' %}"
          onsubmit="return confirm('Are you sure you want to delete ALL stays? This cannot be undone.');"
          style="display:flex; gap:12px; align-items:center; flex-wrap:wrap;">
      {% csrf_token %}
      <button class="btn btn-danger" type="submit">Delete All Stays</button>
    </form>
  </div>
  <script>
    (function(){
      const current = (document.body.dataset.theme || '{{ site_appearance.theme|default:"dark" }}').toLowerCase();
      const radios = Array.from(document.querySelectorAll('input[name="theme"]'));
      const btn = document.getElementById('apply-theme');
      const active = radios.find(r => r.value === current) || radios[0];
      if (active) active.checked = true;
      function setCookie(name, value, days){
        const d = new Date();
        d.setTime(d.getTime() + (days*24*60*60*1000));
        document.cookie = `${name}=${value}; expires=${d.toUTCString()}; path=/`;
      }
      btn.addEventListener('click', () => {
        const sel = radios.find(r => r.checked);
        const val = sel ? sel.value : 'dark';
        document.body.setAttribute('data-theme', val);
        setCookie('theme', val, 365);
      });
    })();
  </script>
{% endblock %}
